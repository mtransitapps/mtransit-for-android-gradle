language: android
jdk: oraclejdk8

sudo: false
install: true

cache:
  directories:
    - ${TRAVIS_BUILD_DIR}/gradle/caches/
    - ${TRAVIS_BUILD_DIR}/gradle/wrapper/dists/
    - '$HOME/.android/build-cache'
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    - '$HOME/.sonar/cache'
    - '$HOME/.gradle'
    - '.gradle'

env:
  global:
    - ANDROID_API_LEVEL=27
    - ANDROID_BUILD_TOOLS_VERSION=27.0.1

android:
  components:
    - tools # to get the new `repository-11.xml`
    - platform-tools
    - tools # to install Android SDK tools
    - build-tools-$ANDROID_BUILD_TOOLS_VERSION
    - android-$ANDROID_API_LEVEL
    - addon-google_apis-google-$ANDROID_API_LEVEL
    - extra-google-google_play_services
    - extra-android-support
    - extra-google-m2repository
    - extra-android-m2repository

branches:
  only:
    - master
    - mmathieum

git:
  submodules: false

before_install:
 - git submodule update --init --recursive commons-android
 - git submodule update --init --recursive mtransit-for-android
 - chmod +x gradlew

script: ./gradlew build assemble sonarqube

addons:
  sonarcloud:
    organization: "mtransitapps-github"
    token:
      secure: "qxThn6dzl44ECTHUBEO+4HBFyRun+Xn0Hf6jLrAsHSCSDwtncFqSQviNgooXONUIWcUXrz7azkVA1oe/zAHWiuBUW10Zkeo9s7k+wiQY04LJaoy4iDNnro9nbXLBdklUoeOLgx6fRhuZkE1zdQ6k8aBD0CWIk2pqf4tfrixfRyJn5AssEk/vk5ohy2ZMIYlz5r4P6r5ioAT1ATRMgyikXhDZBAZPBCxRKHhzlSfaBhlOcCQ2qK7N0yjfCrCc1x8qPUMLmeJGupXTbH/PdCyX8P5RMLMAPx/WeN0vNdqWN9zHq32svlIeYRNz6cPi+w5cN+6FKN0SNe3Dc+KZwDt9lCeWbXahLwn8VeZt0xKoWgMYGsSMMmE12gNSK8mG17kjieQwTSbwOSsbpFC7ix1bwKwgSuLuavXIn4tzRdNfIsFtH4nS5V1PueMen+1qvcYBaHPaOlIMDRMYhgFjbdpRB5+/YwDviK/6uRrWwUU2Ok70x+5tisZpf5Ay7wlQeAY8UuByjkVAdFkpFaFEgCFV+0Bcf9U7HYn0mkYbLKF4FBjrWar0PwjyuQfEV3WLdo6AcRXgcvzMta7b+gyYyb+XsD5Jdpt3EwYies7yLxZGvzEV+fzOV3LrUkMs8bwwme6L4NiuVqtUbCFbPMOf74jjpo2lZo1OyxYGEzDN93oMvmU="
    branches:
      - master
      - mmathieum
