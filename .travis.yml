language: android
jdk: oraclejdk8

sudo: false
install: true

cache:
  directories:
    - ${TRAVIS_BUILD_DIR}/gradle/caches/
    - ${TRAVIS_BUILD_DIR}/gradle/wrapper/dists/
    - '$HOME/.android/build-cache'
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    - '$HOME/.sonar/cache'
    - '$HOME/.gradle'
    - '.gradle'

install
  - $ANDROID_HOME/tools/bin/sdkmanager --install "tools"
  - $ANDROID_HOME/tools/bin/sdkmanager --install "platform-tools"
  - $ANDROID_HOME/tools/bin/sdkmanager --install "build-tools;27.0.2"
  - $ANDROID_HOME/tools/bin/sdkmanager --install "extras;android;m2repository"
  - $ANDROID_HOME/tools/bin/sdkmanager --install "extras;google;google_play_services"
  - $ANDROID_HOME/tools/bin/sdkmanager --install "extras;google;m2repository"

branches:
  only:
    - master
    - mmathieum

git:
  submodules: false

before_install:
 - git submodule update --init --recursive commons-android
 - git submodule update --init --recursive mtransit-for-android
 - chmod +x gradlew

script:
 - ./gradlew build assemble
 - ./gradlew :mtransit-for-android:sonarqube -Dsonar.host.url=https://sonarcloud.io -Dsonar.organization=mtransitapps-github -Dsonar.login=$MT_SONAR_LOGIN

