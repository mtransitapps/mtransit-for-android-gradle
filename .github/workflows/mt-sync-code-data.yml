name: MT SYNC CODE & DATA # download & paser
on: workflow_dispatch # manual
jobs:
  MT-SETUP-GIT:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v2
        with:
          submodules: false
      - name: MT checkout submodules
        run: ./checkout_submodules.sh
  MT-SETUP-CODE:
    runs-on: ubuntu-latest
    needs: MT-SETUP-GIT
    steps:
      - name: MT code setup
        run: sh ./commons/code_setup.sh
        # run: "${GITHUB_WORKSPACE}/commons/code_setup.sh"
  MT-SETUP-DEPENDENCIES:
    runs-on: ubuntu-latest
    needs:  MT-SETUP-CODE
    steps:
      - name: Set up JDK 1.8
        uses: actions/setup-java@v2
        with:
          distribution: 'adopt-hotspot' # 'adopt'
          java-version: '11'
      - name: MT Gradle wrapper
        uses: actions/cache@v2
        with:
          path: |
            ~/.gradle/wrapper
          key: gradle-wrapper-${{ hashFiles('gradle/wrapper/gradle-wrapper.properties') }}
          restore-keys: |
            gradle-wrapper-${{ hashFiles('gradle/wrapper/gradle-wrapper.properties') }}
      - name: MT Gradle cache > Generate key
        run: ./init_cache_key.sh
      - name: MT Gradle cache
        uses: actions/cache@v2
        with:
          path: |
            ~/.gradle/caches
          key: gradle-cache-${{ hashFiles('gradle_cache_key_checksum.txt') }}
          restore-keys: |
            gradle-cache-${{ hashFiles('gradle_cache_key_checksum.txt') }}
            gradle-cache- # fallback to using the latest cache if no exact match is found
      - name: MT Download Dependencies
        run: ./gradlew androidDependencies --no-daemon --no-parallel --no-configure-on-demand --max-workers=1 --console=plain
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
